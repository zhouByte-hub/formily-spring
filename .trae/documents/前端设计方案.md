# 1. 目的
我需要使用Formily框架来实现一个可视化的表单设计器；
- 下列需求一定要和Formily框架相关，不能脱离Formily框架实现；
- 生成的表单Schema必须符合Formily框架的规范；


# 2. 功能需求
## 2.1 自定义组件
用户可以将组件库中的组件拖拽到画布上，自定义表单的字段类型和布局。
组件库组件如下：
（1）表单组件
```json
{ group: 'Form', type: 'Input', label: '文本输入框 Input', schema: { type: 'string', title: 'Input', required: false, 'x-decorator': 'FormItem', 'x-component': 'Input', 'x-component-props': { placeholder: 'Please input' } } },
  { group: 'Form', type: 'NumberPicker', label: '数字输入框 Number', schema: { type: 'number', title: 'Number', required: false, 'x-decorator': 'FormItem', 'x-component': 'NumberPicker', 'x-component-props': { min: 0 } } },
  { group: 'Form', type: 'Password', label: '密码框 Password', schema: { type: 'string', title: 'Password', required: false, 'x-decorator': 'FormItem', 'x-component': 'Password', 'x-component-props': { placeholder: 'Password' } } },
  { group: 'Form', type: 'Textarea', label: '多行文本 Textarea', schema: { type: 'string', title: 'Textarea', required: false, 'x-decorator': 'FormItem', 'x-component': 'Textarea', 'x-component-props': { placeholder: '...' } } },
  { group: 'Form', type: 'Select', label: '下拉列表 Select', schema: { type: 'string', title: 'Select', required: false, 'x-decorator': 'FormItem', 'x-component': 'Select', 'enum': [{ label: 'A', value: 'a' }, { label: 'B', value: 'b' }] } },
  { group: 'Form', type: 'RadioGroup', label: '单选 Radio', schema: { type: 'string', title: 'Radio', required: false, 'x-decorator': 'FormItem', 'x-component': 'RadioGroup', 'enum': [{ label: 'Yes', value: 'yes' }, { label: 'No', value: 'no' }] } },
  { group: 'Form', type: 'CheckboxGroup', label: '复选 Checkbox', schema: { type: 'array', title: 'Checkbox', required: false, 'x-decorator': 'FormItem', 'x-component': 'CheckboxGroup', 'enum': [{ label: 'A', value: 'a' }, { label: 'B', value: 'b' }] } },
  { group: 'Form', type: 'Switch', label: '开关 Switch', schema: { type: 'boolean', title: 'Switch', required: false, 'x-decorator': 'FormItem', 'x-component': 'Switch' } },
  { group: 'Form', type: 'DateTimePicker', label: '日期时间 Datetime', schema: { type: 'string', title: 'DateTime', required: false, 'x-decorator': 'FormItem', 'x-component': 'DateTimePicker' } },
  { group: 'Form', type: 'Slider', label: '滑块 Slider', schema: { type: 'number', title: 'Slider', required: false, 'x-decorator': 'FormItem', 'x-component': 'Slider', 'x-component-props': { min: 0, max: 100 } } },
  { group: 'Form', type: 'Rate', label: '评分 Rate', schema: { type: 'number', title: 'Rate', required: false, 'x-decorator': 'FormItem', 'x-component': 'Rate' } },
  { group: 'Form', type: 'FormContainer', label: '表单容器 Form Container', schema: { type: 'void', 'x-component': 'Card', 'x-component-props': { header: 'Form Container' } } }
```

（2）基础组件
```json
{ group: 'Basic', type: 'Button', label: '按钮 Button', schema: { type: 'void', 'x-component': 'Button', 'x-component-props': { text: 'Click me' } } },
  { group: 'Basic', type: 'Tag', label: '标签 Tag', schema: { type: 'void', 'x-component': 'Tag', 'x-component-props': { text: 'Tag' } } },
  { group: 'Basic', type: 'Link', label: '链接 Link', schema: { type: 'void', 'x-component': 'Link', 'x-component-props': { text: 'Link', href: '#' } } },
  { group: 'Basic', type: 'LoadingIndicator', label: '加载指示器 Loading', schema: { type: 'void', 'x-component': 'LoadingIndicator', 'x-component-props': { rows: 3, animated: true } } },
  { group: 'Basic', type: 'Alert', label: '提示 Alert', schema: { type: 'void', 'x-component': 'Alert', 'x-component-props': { title: 'Info', type: 'info', description: 'Message' } } },
  { group: 'Basic', type: 'Tooltip', label: '提示 Tooltip', schema: { type: 'void', 'x-component': 'Tooltip', 'x-component-props': { text: 'Hover', content: 'Tooltip content' } } },
  { group: 'Basic', type: 'Popover', label: '弹出气泡 Popover', schema: { type: 'void', 'x-component': 'Popover', 'x-component-props': { text: 'Click', title: 'Popover', content: 'Popover content' } } },
  { group: 'Basic', type: 'Progress', label: '进度条 Progress', schema: { type: 'void', 'x-component': 'Progress', 'x-component-props': { percentage: 50 } } },
  { group: 'Basic', type: 'Divider', label: '分割线 Divider', schema: { type: 'void', 'x-component': 'Divider' } },
  { group: 'Basic', type: 'Card', label: '面板 Panel', schema: { type: 'void', 'x-component': 'Card', 'x-component-props': { header: 'Panel' } } }
```

（3）数据展示组件
```json
{ group: 'Display', type: 'Table', label: '表格 Table', schema: { type: 'void', 'x-component': 'Table', 'x-component-props': { columns: [{ prop: 'name', label: 'Name' }], data: [{ name: 'Row 1' }, { name: 'Row 2' }] } } },
  { group: 'Display', type: 'List', label: '列表 List', schema: { type: 'void', 'x-component': 'List', 'x-component-props': { items: ['Item 1', 'Item 2'] } } },
  { group: 'Display', type: 'Descriptions', label: '描述列表 Descriptions', schema: { type: 'void', 'x-component': 'Descriptions', 'x-component-props': { title: 'Descriptions', items: [{ label: 'A', value: '1' }, { label: 'B', value: '2' }] } } },
  { group: 'Display', type: 'Tree', label: '树形控件 Tree', schema: { type: 'void', 'x-component': 'Tree', 'x-component-props': { data: [{ label: 'Node 1', children: [{ label: 'Child 1' }] }] } } },
  { group: 'Display', type: 'Collapse', label: '折叠面板 Collapse', schema: { type: 'void', 'x-component': 'Collapse', 'x-component-props': { items: [{ name: '1', title: 'Title 1', content: 'Content 1' }] } } },
  { group: 'Display', type: 'Tabs', label: '标签页 Tabs', schema: { type: 'void', 'x-component': 'Tabs', 'x-component-props': { panes: [{ name: 'a', label: 'Tab A', content: 'Content A' }, { name: 'b', label: 'Tab B', content: 'Content B' }] } } },
  { group: 'Display', type: 'Carousel', label: '轮播图 Carousel', schema: { type: 'void', 'x-component': 'Carousel', 'x-component-props': { items: ['Slide 1', 'Slide 2'], height: '160px' } } },
  { group: 'Display', type: 'Statistic', label: '统计卡片 Statistic', schema: { type: 'void', 'x-component': 'Statistic', 'x-component-props': { title: 'Orders', value: 1024 } } },
  { group: 'Display', type: 'Timeline', label: '时间轴 Timeline', schema: { type: 'void', 'x-component': 'Timeline', 'x-component-props': { items: [{ timestamp: '2026-01-01', content: 'Event' }] } } },
  { group: 'Display', type: 'Breadcrumb', label: '面包屑 Breadcrumb', schema: { type: 'void', 'x-component': 'Breadcrumb', 'x-component-props': { items: [{ text: 'Home' }, { text: 'Page' }] } } },
  { group: 'Display', type: 'Pagination', label: '分页器 Pagination', schema: { type: 'void', 'x-component': 'Pagination', 'x-component-props': { total: 100, pageSize: 10 } } }
```

上述是组件的Schema格式，组件与组件之间是可以存在嵌套关系的，当用户将子组件拖拽到父组件中时，需要将子组件的Schema嵌套到父组件的Schema中。

当用户编辑结束点击”保存“按钮时，需要向后端发送请求，将当前表单的Schema保存到数据库中，接口信息如下：
- 请求方式如下：Post
- 请求路径如下：/api/schema
- 请求体如下：
```json
{
    "id": "Schema对应的ID",
    "value": "自定义组件的Scheme值"
}
```
value包含三个值：
- initial_values: 自定义组件中可以编辑的组件名称。
- datesources: 有的组件可以发送请求到后端获取数据，所以datesources记录这当前用户自定义组件中所有的请求信息，每个请求包含请求路径、请求方法、请求参数等；
- schema：这里存放的就是具体的组件Schema，如果组件之间存在嵌套关系，那么schema中就会包含子组件的Schema；同时如果子组件需要请求后端获取数据，那么子组件Schema中就需要提供一个datesource_id的属性，记录在datesources中对应请求信息的ID值。

## 2.2 Schema列表
Schema菜单下展示所有组件的Schema，用户可以在该菜单下查看所有组件的Schema，对于每个Schema提供的操作如下：新增、删除、修改、预览。
当用户点击预览的时候需要弹出一个悬浮框展示当前组件的预览效果并回显对应的数据。
对于预览功能，后端会根据用户提交的Schema值生成对应的预览效果，并返回给前端展示。

